<%# Main container using Flexbox for two columns %>
<div class="flex h-[calc(100vh-150px)] border border-gray-300 rounded-lg bg-white shadow-md overflow-hidden">

  <%# Left Pane: Chat List Sidebar %>
  <div id="chats-list" class="w-1/4 border-r border-gray-300 overflow-y-auto p-4 bg-gray-50">
    <h2 class="text-lg font-semibold mb-4 text-gray-700">My Chats ðŸ’¬</h2>

    <%# Button/Form to create a new chat %>
    <%= form_with(model: Chat.new, url: chats_path, method: :post, class: "mb-4") do |f| %>
      <%# You could add fields for title/description/model here if desired %>
      <%# Example: f.text_field :title, placeholder: "Optional Title", class: "..." %>
      <%= f.submit "âœ¨ Start New Chat", class: "w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded cursor-pointer" %>
    <% end %>


    <%# List of existing chats - Render the partial for each chat %>
    <div id="user-chats"> <%# A target for potential Turbo Stream updates to the list %>
      <% if @chats.any? %>
        <% @chats.each do |chat_item| %>
          <%= render partial: "chats/chat_link", locals: { chat_item: chat_item, current_chat: @chat } %>
        <% end %>
      <% else %>
        <p class="text-gray-500 italic">No chats yet. Start a new one!</p>
      <% end %>
    </div>
  </div>

  <%# Right Pane: Chat Window %>
  <div class="w-3/4 flex flex-col">
    <% if @chat %>
      <%# Connect to Turbo Stream for this specific chat's messages %>
      <%= turbo_stream_from [@chat, "messages"] %>

      <%# Chat Header (Title/Description/Actions) %>
      <div class="p-4 border-b border-gray-300 bg-white flex justify-between items-center">
        <div>
          <h1 class="text-xl font-semibold text-gray-800"><%= @chat.title %></h1>
          <% if @chat.description.present? %>
            <p class="text-sm text-gray-500"><%= @chat.description %></p>
          <% end %>
           <p class="text-xs text-gray-400">Model: <%= @chat.model_id %></p>
        </div>
        <div>
            <%= button_to "Delete Chat", chat_path(@chat), method: :delete, form: { data: { turbo_confirm: "Are you sure you want to delete this chat?" } }, class: "text-red-500 hover:text-red-700 text-sm font-medium" %>
        </div>
      </div>

      <%# Messages Area - Use flex-grow to take available space, overflow-y-auto for scrolling %>
      <div id="messages" class="flex-grow overflow-y-auto p-4 space-y-4 bg-gray-50">
        <%# Render existing messages using the message partial %>
        <%= render @messages %>
        <%# New messages will be appended here by Turbo Streams %>
      </div>

      <%# Input Area Form %>
      <div class="p-4 border-t border-gray-300 bg-white">
        <%= form_with(model: [@chat, Message.new], url: chat_messages_path(@chat), method: :post, class: "flex items-center space-x-2") do |f| %>
          <%= f.text_area :content,
                placeholder: "Ask anything...",
                class: "flex-grow border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",
                rows: 2,
                data: { controller: 'textarea-autogrow' } %> <%# Optional: Stimulus for auto-resizing %>
          <%= f.submit "Send ðŸš€", class: "bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded cursor-pointer" %>
        <% end %>
      </div>

    <% else %>
      <%# Placeholder when no chat is selected %>
      <div class="flex-grow flex items-center justify-center p-4 text-gray-500">
        <p>Select a chat from the left or start a new one! ðŸŽ‰</p>
      </div>
    <% end %>
  </div>

</div>
